<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Swipe between maps</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
    </style>
</head>

<body>
    <style>
        body {
            overflow: hidden;
        }

        body * {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }

        .map-overlay {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.8);
            margin-right: 20px;
            font-family: Arial, sans-serif;
            overflow: auto;
            border-radius: 3px;
        }

        #menu {
            background: #fff;
            position: absolute;
            z-index: 1;
            top: 10px;
            left: 10px;
            border-radius: 3px;
            width: 120px;
            border: 1px solid rgba(0, 0, 0, 0.4);
            font-family: 'Open Sans', sans-serif;
        }

        #menu a {
            font-size: 13px;
            color: #404040;
            display: block;
            margin: 0;
            padding: 0;
            padding: 10px;
            text-decoration: none;
            border-bottom: 1px solid rgba(0, 0, 0, 0.25);
            text-align: center;
        }

        #menu a:last-child {
            border: none;
        }

        #menu a:hover {
            background-color: #f8f8f8;
            color: #404040;
        }

        #menu a.active {
            background-color: #3887be;
            color: #ffffff;
        }

        #menu a.active:hover {
            background: #3074a4;
        }
    </style>
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-compare/v0.4.0/mapbox-gl-compare.js"></script>
    <link rel="stylesheet"
        href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-compare/v0.4.0/mapbox-gl-compare.css"
        type="text/css">
    <nav id="menu">
        <legend>lockdowns</legend>
    </nav>

    <div id="comparison-container">
        <div id="before" class="map"></div>
        <div id="after" class="map"></div>
    </div>
    <div class='map-overlay' id='features'>
        <h2> TfL Rail Station Footfall</h2>
        <div id='pd'>
            <p>Hover over a station!</p>
        </div>
    </div>
    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoidGlhbmExMjUiLCJhIjoiY2tpMGJpcGlkMjY3aDJycDV5amkzZzN1cyJ9.NEP-axK_c0O8ayn3AQJ9XQ';
        var beforeMap = new mapboxgl.Map({
            container: 'before',
            style: 'mapbox://styles/tiana125/ckk5f38pk0hbb17mkkq6skk2g',
            center: [-0.1, 51.5],
            zoom: 10
        });

        var afterMap = new mapboxgl.Map({
            container: 'after',
            style: 'mapbox://styles/tiana125/ckk5f38pk0hbb17mkkq6skk2g',
            center: [-0.1, 51.5],
            zoom: 10
        });

        // A selector or reference to HTML element
        var container = '#comparison-container';

        var map = new mapboxgl.Compare(beforeMap, afterMap, container, {
            // Set this to enable comparing two maps by mouse movement:
            // mousemove: true
        });



        beforeMap.on('load', function () {    //  can only add additional layers after the map has loaded

            beforeMap.addSource('source', {
                type: 'vector',
                url: 'mapbox://tiana125.dv2trcco'// Mapbox tileset Map ID
            });

            beforeMap.addLayer({
                id: 'beforeld1',
                type: 'circle',
                'source': 'source',
                'source-layer': 'footfall-bzshet', // name of dataset layer
                'layout': {
                    'visibility': 'visible' // default visible
                },
                paint: {
                    'circle-color': '#fffef7',
                    'circle-opacity': 0.95,
                    'circle-stroke-width': {
                        stops: [[8, 0.5], [13, 3], [16, 4]]  // The width properties change at different zoom levels, getting thicker
                    },
                    'circle-stroke-color': '#000',
                    'circle-stroke-opacity': 1,
                    'circle-radius': {
                        property: 'beforeld1', // 0 - 75.71
                        stops: [                             // The circle radius varies according to the zoom level and the number of passengers
                            [{ zoom: 9, value: 0 }, 1],
                            [{ zoom: 9, value: 5 }, 3],
                            [{ zoom: 9, value: 125 }, 5],
                            [{ zoom: 12, value: 0 }, 3],
                            [{ zoom: 12, value: 125 }, 40],
                            [{ zoom: 16, value: 0 }, 4],
                            [{ zoom: 16, value: 125 }, 150],
                        ]

                    }
                }
            });



            beforeMap.addLayer({
                id: 'beforeld2',
                type: 'circle',
                'source': 'source',
                'source-layer': 'footfall-bzshet', // name of dataset layer 
                'layout': {
                    'visibility': 'none' // default not visible
                },
                paint: {
                    'circle-color': '#fffef7',
                    'circle-opacity': 0.95,
                    'circle-stroke-width': {
                        stops: [[8, 0.5], [13, 3], [16, 4]]  // The width properties change at different zoom levels, getting thicker
                    },
                    'circle-stroke-color': '#000',
                    'circle-stroke-opacity': 1,
                    'circle-radius': {
                        property: 'beforeld2', // 0 - 125
                        stops: [                             // The circle radius varies according to the zoom level and the number of passengers
                            [{ zoom: 9, value: 0 }, 1],
                            [{ zoom: 9, value: 5 }, 3],
                            [{ zoom: 9, value: 125 }, 5],
                            [{ zoom: 12, value: 0 }, 3],
                            [{ zoom: 12, value: 125 }, 40],
                            [{ zoom: 16, value: 0 }, 4],
                            [{ zoom: 16, value: 125 }, 150],
                        ]
                    }
                }
            });
        });












        afterMap.on('load', function () {    // This is our first example of asynchronous JS. We can only add additional layers after the map has loaded
            // Add the circle layer to the map

            afterMap.addSource('source', {
                type: 'vector',
                url: 'mapbox://tiana125.dv2trcco'// Mapbox tileset Map ID
            });

            afterMap.addLayer({
                id: 'afterld1',
                type: 'circle',
                'source': 'source',
                'source-layer': 'footfall-bzshet', // name of dataset layer
                'layout': {
                    'visibility': 'visible' // default visible
                },
                paint: {
                    'circle-color': '#fffef7',
                    'circle-opacity': 0.95,
                    'circle-stroke-width': {
                        stops: [[8, 0.5], [13, 3], [16, 4]] // The width properties change at different zoom levels, getting thicker
                    },
                    'circle-stroke-color': '#000',
                    'circle-stroke-opacity': 1,
                    'circle-radius': {
                        property: 'footfall',
                        stops: [                             // The circle radius varies according to the zoom level and the number of passengers
                            [{ zoom: 9, value: 0 }, 1],
                            [{ zoom: 9, value: 5 }, 3],
                            [{ zoom: 9, value: 125 }, 5],
                            [{ zoom: 12, value: 0 }, 3],
                            [{ zoom: 12, value: 125 }, 40],
                            [{ zoom: 16, value: 0 }, 4],
                            [{ zoom: 16, value: 125 }, 150],
                        ]
                    }
                }
            });


            afterMap.addLayer({
                id: 'afterld2',
                type: 'circle',
                'source': 'source',
                'source-layer': 'footfall-bzshet', // name of dataset layer CHANGETHIS
                'layout': {
                    'visibility': 'none' // default visible 
                },
                paint: {
                    'circle-color': '#fffef7',
                    'circle-opacity': 0.95,
                    'circle-stroke-width': {
                        stops: [[8, 0.5], [13, 3], [16, 4]] // The width properties change at different zoom levels, getting thicker
                    },
                    'circle-stroke-color': '#000',
                    'circle-stroke-opacity': 1,
                    'circle-radius': {
                        property: 'footfall',
                        stops: [                             // The circle radius varies according to the zoom level and the number of passengers
                            [{ zoom: 9, value: 0 }, 1],
                            [{ zoom: 9, value: 5 }, 3],
                            [{ zoom: 9, value: 125 }, 5],
                            [{ zoom: 12, value: 0 }, 3],
                            [{ zoom: 12, value: 125 }, 40],
                            [{ zoom: 16, value: 0 }, 4],
                            [{ zoom: 16, value: 125 }, 150],
                        ]
                    }
                }
            });
        });




















        // toggleLayer(['before ld1', 'after ld1'], 'ld1');
        // toggleLayer(['before ld2', 'after ld2'], 'ld2');
        toggleLayer('lockdown 1');
        toggleLayer('lockdown 2');


        function toggleLayer(name) {
            var link = document.createElement('a');
            link.href = '#';
            link.className = 'active';
            link.textContent = name;

            link.onclick = function (e) {
                var clickedLayer = this.textContent;

                if (name == 'lockdown 1') {
                    beforeMap.setLayoutProperty('beforeld1', 'visibility', 'visible');

                    beforeMap.on('mousemove', function (e) {
                        var boros = beforeMap.queryRenderedFeatures(e.point);

                        if (boros.length > 0) {
                            document.getElementById('pd').innerHTML = '<h3><strong>' + boros[0].properties.name + '</strong></h3><p><strong><em>' +
                                Math.round(boros[0].properties.beforeld1) + '</strong> footfall</em></p>';
                        } else {
                            document.getElementById('pd').innerHTML = '<p>Hover over a station!</p>';
                        }
                    });
                    beforeMap.setLayoutProperty('beforeld2', 'visibility', 'none');
                    afterMap.setLayoutProperty('afterld1', 'visibility', 'visible');

                    afterMap.on('mousemove', function (e) {
                        var boros = afterMap.queryRenderedFeatures(e.point,
                            // layers = { "beforeld1"}
                        );

                        if (boros.length > 0) {
                            document.getElementById('pd').innerHTML = '<h3><strong>' + boros[0].properties.name + '</strong></h3><p><strong><em>' +
                                Math.round(boros[0].properties.afterld1) + '</strong> k footfall</em></p>';
                        } else {
                            document.getElementById('pd').innerHTML = '<p>Hover over a station!</p>';
                        }
                    });

                    afterMap.setLayoutProperty('afterld2', 'visibility', 'none');
                }
                if (name == 'lockdown 2') {
                    beforeMap.setLayoutProperty('beforeld1', 'visibility', 'none');
                    beforeMap.setLayoutProperty('beforeld2', 'visibility', 'visible');
                    afterMap.setLayoutProperty('afterld1', 'visibility', 'none');
                    afterMap.setLayoutProperty('afterld2', 'visibility', 'visible');
                }

            };

            var layers = document.getElementById('menu');
            layers.appendChild(link);

        }




    </script>

</body>

</html>